"use strict";function get_selected_area_name(){return localStorage.getItem("selected_area_name")}function set_selected_area_name(e){localStorage.setItem("selected_area_name",e)}var AreaModel=function(){this.label;this.centerName;this.center;this.trash=new Array;this.calcMostRect=function(){for(var e=0;e<this.trash.length;e++){this.trash[e].calcMostRect(this)}};this.isBlankDay=function(e){var t=[this.center.startDate,this.center.endDate];if(t[0].getTime()<=e.getTime()&&e.getTime()<=t[1].getTime()){return true}return false};this.setCenter=function(e){for(var t in e){if(this.centerName==e[t].name){this.center=e[t]}}};this.sortTrash=function(){this.trash.sort(function(e,t){var n=e.mostRecent.getTime();var r=t.mostRecent.getTime();if(n<r)return-1;if(n>r)return 1;return 0})}};var Description=function(){this.label;this.notice};var TrashModel=function(e,t){function o(e){for(var t=0;t<s.length;t++){if(s[t]==e){return t}}return-1}this.dayLabel;this.mostRecent;this.dayList;this.dayCell=t.split(" ");this.label=e;this.description;var n="";var r=new Date;for(var i in this.dayCell){if(this.dayCell[i].length==1){n+="毎週"+this.dayCell[i]+"曜日 "}else{n+="第"+this.dayCell[i].charAt(1)+this.dayCell[i].charAt(0)+"曜日 "}}this.dayLabel=n;this.getDateLabel=function(){var e=this.mostRecent.getFullYear()+"/"+(1+this.mostRecent.getMonth())+"/"+this.mostRecent.getDate();return this.dayLabel+" "+e};var s=["日","月","火","水","木","金","土"];this.calcMostRect=function(e){var t=this.dayCell;var n="";var r=new Array;for(var i=4;i<=12+3;i++){for(var s in t){var u=false;for(var a=0;a<5;a++){var f=new Date(2013,i-1,1);var l=new Date(f);l.setTime(f.getTime()+1e3*60*60*24*((7+o(t[s].charAt(0))-f.getDay())%7)+a*7*24*60*60*1e3);if(e.isBlankDay(l)){u=true}if(u){l.setTime(l.getTime()+7*24*60*60*1e3)}if(l.getMonth()!=(i-1)%12){continue}if(t[s].length>1){if(a!=t[s].charAt(1)-1){continue}}r.push(l)}}}r.sort(function(e,t){var n=e.getTime();var r=t.getTime();if(n<r)return-1;if(n>r)return 1;return 0});var c=new Date;for(var h in r){if(this.mostRecent==null&&c.getTime()<=r[h].getTime()+8.5*60*60*1e3){this.mostRecent=r[h];break}}this.dayList=r};this.getDayList=function(){var e="<ul>";for(var t in this.dayList){var n=this.dayList[t];e+="<li>"+n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+"</li>"}e+="</ul>";return e}};var CenterModel=function(e){function t(e,t){var n=e[t].split("/");return new Date(n[0],n[1]-1,n[2])}this.name=e[0];this.startDate=t(e,1);this.endDate=t(e,2)};$(function(){function r(){$.get("data/area_days.csv",function(t){var t=t.replace("/¥r/gm","");var r=t.split(String.fromCharCode(10));var i=r.shift().split(",");for(var s in r){var o=r[s].split(",");var u=new AreaModel;u.label=o[0];u.centerName=o[1];n.push(u);for(var s=2;s<2+4;s++){var a=new TrashModel(i[s],o[s]);u.trash.push(a)}}$.get("data/center.csv",function(t){var r=t.split(String.fromCharCode(10));for(var i in r){var s=r[i].split(",");var o=new CenterModel(s);e.push(o)}for(var i in n){var u=n[i];u.setCenter(e)}var a=get_selected_area_name();var f=$("#select_area");var l="";l+='<option value="-1">未選択</option>';for(var c in n){var h=n[c].label;var p=a==h?'selected="selected"':"";l+='<option value="'+c+'" '+p+" >"+h+"</option>"}if(typeof dump=="function"){dump(n)}f.html(l);f.change()})})}function i(e){$.getJSON("data/description.json",function(n){for(var r in n){t.push(n[r])}e();$("#accordion2").show()})}function s(e){var r=n[e];var i=new Date;r.calcMostRect();r.sortTrash();var s=$(window).height()/4;var o="";for(var u in r.trash){var a;var f=r.trash[u];for(var l in t){if(t[l].label==f.label){a=t[l];var c="";var h="";var c="";var p=a.target;for(var d in p){var v=p[d];if(h!=v.furigana){if(h!=""){c+="</ul>"}h=v.furigana;c+='<h4 class="initials">'+h+"</h4>";c+="<ul>"}c+="<li>"+v.name+"</li>"}c+="</ul>";var m=f.getDateLabel();var g=Math.ceil((f.mostRecent.getTime()-i.getTime())/(1e3*60*60*24));var y="";if(g==0){y="今日"}else if(g==1){y="明日"}else if(g==2){y="明後日"}else{y=g+"日後"}o+='<div class="accordion-group" id="accordion-group'+l+'">'+'<div class="accordion-heading">'+'<a class="accordion-toggle" style="height:'+s+'px" data-toggle="collapse" data-parent="#accordion" href="#collapse'+u+'">'+'<div class="left-day">'+y+"</div>"+'<div class="accordion-table" ><img src="'+a.styles.svg+'"  /></div>'+'<h6><p class="text-left date">'+m+"</p></h6>"+"</a>"+"</div>"+'<div id="collapse'+u+'" class="accordion-body collapse">'+'<div class="accordion-inner">'+a.description+"<br />"+c+'<div class="targetDays"></div></div>'+"</div>"+"</div>"}}}var b=$("#accordion");b.html(o);$(".accordion-body").on("shown.bs.collapse",function(){var e=$("body");var t=$($(this).parent().get(0)).offset().top;e.animate({scrollTop:t},50)});$(".accordion-body").on("hidden.bs.collapse",function(){if($(".in").length==0){$("html, body").scrollTop(0)}})}function o(e){if(e!=-1){set_selected_area_name(n[e].label)}if(e!=-1&&$("#accordion").children().length==0){i(function(){s(e)})}else{s(e)}}function u(e){switch(e.code){case e.PERMISSION_DENIED:return"User denied the request for Geolocation.";case e.POSITION_UNAVAILABLE:return"Location information is unavailable.";case e.TIMEOUT:return"The request to get user location timed out.";case e.UNKNOWN_ERROR:default:return"An unknown error occurred."}}function a(e){for(var t in n){if(n[t].label==e){return t}}return-1}var e=new Array;var t=new Array;var n=new Array;$("#select_area").change(function(e){var t=$(e.target).val();o(t)});$("#gps_area").click(function(){navigator.geolocation.getCurrentPosition(function(e){$.getJSON("area_candidate.php",{latitude:e.coords.latitude,longitude:e.coords.longitude},function(e){if(e.result==true){var t=e.candidate;var n=a(t);$("#select_area").val(n).change();alert(t+"が設定されました")}else{alert(e.reason)}})},function(e){alert(u(e))})});if(get_selected_area_name()==null){$("#accordion2").show();$("#collapseZero").addClass("in")}if(!navigator.geolocation){$("#gps_area").css("display","none")}r()})