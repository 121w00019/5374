var AreaModel=function(){this.label;this.centerName;this.center;this.trash=[];this.calcMostRect=function(){for(var b=0;b<this.trash.length;b++)this.trash[b].calcMostRect(this)};this.isBlankDay=function(b){var c=[this.center.startDate,this.center.endDate];return c[0].getTime()<=b.getTime()&&b.getTime()<=c[1].getTime()?!0:!1};this.setCenter=function(b){for(var c in b)this.centerName==b[c].name&&(this.center=b[c])};this.sortTrash=function(){this.trash.sort(function(b,c){var g=b.mostRecent.getTime(),
d=c.mostRecent.getTime();return g<d?-1:g>d?1:0})}},Description=function(){this.label;this.notice},TrashModel=function(b,c){function g(b){for(var a=0;a<m.length;a++)if(m[a]==b)return a;return-1}this.dayLabel;this.mostRecent;this.dayList;this.dayCell=c.split(" ");this.label=b;this.description;var d="",f;for(f in this.dayCell)d=1==this.dayCell[f].length?d+("\u6bce\u9031"+this.dayCell[f]+"\u66dc\u65e5 "):d+("\u7b2c"+this.dayCell[f].charAt(1)+this.dayCell[f].charAt(0)+"\u66dc\u65e5 ");this.dayLabel=d;
this.getDateLabel=function(){var b=this.mostRecent.getFullYear()+"/"+(1+this.mostRecent.getMonth())+"/"+this.mostRecent.getDate();return this.dayLabel+" "+b};var m="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("");this.calcMostRect=function(b){for(var a=this.dayCell,h=[],l=4;15>=l;l++)for(var c in a)for(var f=!1,d=0;5>d;d++){var p=new Date(2013,l-1,1),e=new Date(p);e.setTime(p.getTime()+864E5*((7+g(a[c].charAt(0))-p.getDay())%7)+6048E5*d);b.isBlankDay(e)&&(f=!0);f&&e.setTime(e.getTime()+6048E5);
e.getMonth()!=(l-1)%12||1<a[c].length&&d!=a[c].charAt(1)-1||h.push(e)}h.sort(function(a,b){var e=a.getTime(),h=b.getTime();return e<h?-1:e>h?1:0});b=new Date;for(var n in h)if(null==this.mostRecent&&b.getTime()<=h[n].getTime()+306E5){this.mostRecent=h[n];break}this.dayList=h};this.getDayList=function(){var b="<ul>",a;for(a in this.dayList)var h=this.dayList[a],b=b+("<li>"+h.getFullYear()+"/"+(h.getMonth()+1)+"/"+h.getDate()+"</li>");return b+"</ul>"}},CenterModel=function(b){function c(b,c){var f=
b[c].split("/");return new Date(f[0],f[1]-1,f[2])}this.name=b[0];this.startDate=c(b,1);this.endDate=c(b,2)};function get_selected_area_name(){return localStorage.getItem("selected_area_name")}function set_selected_area_name(b){localStorage.setItem("selected_area_name",b)}
$(function(){function b(a){$.getJSON("data/description.json",function(b){for(var l in b)m.push(b[l]);a();$("#accordion2").show()})}function c(a){a=k[a];a.calcMostRect();a.sortTrash();var b=$(window).height()/4,l="",c;for(c in a.trash){var f,d=a.trash[c],p;for(p in m)if(m[p].label==d.label){f=m[p];var e="",n="",e="",q=f.target,g;for(g in q){var r=q[g];n!=r.furigana&&(""!=n&&(e+="</ul>"),n=r.furigana,e+='<h4 class="initials">'+n+"</h4>",e+="<ul>");e+="<li>"+r.name+"</li>"}e+="</ul>";n=d.getDateLabel();
q=Math.ceil(d.mostRecent.getTime()-today.getTime());r="";r=0==q?"\u4eca\u65e5":1==q?"\u660e\u65e5":2==q?"\u660e\u5f8c\u65e5":q+"\u65e5\u5f8c";l+='<div class="accordion-group" id="accordion-group'+p+'"><div class="accordion-heading"><a class="accordion-toggle" style="height:'+b+'px" data-toggle="collapse" data-parent="#accordion" href="#collapse'+c+'"><div class="left-day">'+r+'</div><div class="accordion-table" ><img src="'+f.styles.svg+'"  /></div><h6><p class="text-left date">'+n+'</p></h6></a></div><div id="collapse'+
c+'" class="accordion-body collapse"><div class="accordion-inner">'+f.description+"<br />"+e+'<div class="targetDays"></div></div></div></div>'}}$("#accordion").html(l);$(".accordion-body").on("shown.bs.collapse",function(){var a=$("body"),b=$($(this).parent().get(0)).offset().top;a.animate({scrollTop:b},50)});$(".accordion-body").on("hidden.bs.collapse",function(){0==$(".in").length&&$("html, body").scrollTop(0)})}function g(a){-1!=a&&set_selected_area_name(k[a].label);-1!=a&&0==$("#accordion").children().length?
b(function(){c(a)}):c(a)}function d(a){switch(a.code){case a.PERMISSION_DENIED:return"User denied the request for Geolocation.";case a.POSITION_UNAVAILABLE:return"Location information is unavailable.";case a.TIMEOUT:return"The request to get user location timed out.";default:return"An unknown error occurred."}}var f=[],m=[],k=[];$("#select_area").change(function(a){a=$(a.target).val();g(a)});$("#gps_area").click(function(){navigator.geolocation.getCurrentPosition(function(a){$.getJSON("area_candidate.php",
{latitude:a.coords.latitude,longitude:a.coords.longitude},function(a){if(!0==a.result){a=a.candidate;var b;a:{for(b in k)if(k[b].label==a)break a;b=-1}$("#select_area").val(b).change();alert(a+"\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3057\u305f")}else alert(a.reason)})},function(a){alert(d(a))})});null==get_selected_area_name()&&($("#accordion2").show(),$("#collapseZero").addClass("in"));navigator.geolocation||$("#gps_area").css("display","none");(function(){$.get("data/area_days.csv",function(a){a=
a.replace("/\u00a5r/gm","");a=a.split(String.fromCharCode(10));var b=a.shift().split(","),c;for(c in a){var d=a[c].split(","),g=new AreaModel;g.label=d[0];g.centerName=d[1];k.push(g);for(c=2;6>c;c++){var m=new TrashModel(b[c],d[c]);g.trash.push(m)}}$.get("data/center.csv",function(a){a=a.split(String.fromCharCode(10));for(var b in a){var c=a[b].split(","),c=new CenterModel(c);f.push(c)}for(b in k)k[b].setCenter(f);b=get_selected_area_name();a=$("#select_area");var c='<option value="-1">\u672a\u9078\u629e</option>',
d;for(d in k)var g=k[d].label,c=c+('<option value="'+d+'" '+(b==g?'selected="selected"':"")+" >"+g+"</option>");"function"==typeof dump&&dump(k);a.html(c);a.change()})})})()});