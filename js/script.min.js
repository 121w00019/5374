var AreaModel=function(){this.label;this.centerName;this.center;this.trash=[];this.calcMostRect=function(){for(var b=0;b<this.trash.length;b++)this.trash[b].calcMostRect(this)};this.isBlankDay=function(b){var c=[this.center.startDate,this.center.endDate];return c[0].getTime()<=b.getTime()&&b.getTime()<=c[1].getTime()?!0:!1};this.setCenter=function(b){for(var c in b)this.centerName==b[c].name&&(this.center=b[c])};this.sortTrash=function(){this.trash.sort(function(b,c){var k=b.mostRecent.getTime(),
d=c.mostRecent.getTime();return k<d?-1:k>d?1:0})}},Description=function(){this.label;this.notice},TrashModel=function(b,c){function k(b){for(var a=0;a<n.length;a++)if(n[a]==b)return a;return-1}this.dayLabel;this.mostRecent;this.dayList;this.dayCell=c.split(" ");this.label=b;this.description;var d="",e;for(e in this.dayCell)d=1==this.dayCell[e].length?d+("\u6bce\u9031"+this.dayCell[e]+"\u66dc\u65e5 "):d+("\u7b2c"+this.dayCell[e].charAt(1)+this.dayCell[e].charAt(0)+"\u66dc\u65e5 ");this.dayLabel=d;
this.getDateLabel=function(){var b=this.mostRecent.getFullYear()+"/"+(1+this.mostRecent.getMonth())+"/"+this.mostRecent.getDate();return this.dayLabel+" "+b};var n="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("");this.calcMostRect=function(b){for(var a=this.dayCell,p=[],r=new Date,c=4;15>=c;c++)for(var h in a)for(var e=!1,l=0;5>l;l++){var g=new Date(2013,c-1,1),f=new Date(g);1==a[h].length?(f.setTime(g.getTime()+864E5*((7+k(a[h])-g.getDay())%7)+6048E5*l),f.getMonth()+1==c%12&&(p.push(f),null==
this.mostRecent&&f.getTime()>r.getTime()&&(this.mostRecent=f))):(f.setTime(g.getTime()+864E5*((7+k(a[h].charAt(0))-g.getDay())%7)+6048E5*l),b.isBlankDay(f)&&(e=!0),e&&f.setTime(f.getTime()+6048E5),l==a[h].charAt(1)-1&&(p.push(f),null==this.mostRecent&&f.getTime()>r.getTime()&&(this.mostRecent=f)))}this.dayList=p};this.getDayList=function(){var b="<ul>",a;for(a in this.dayList)var p=this.dayList[a],b=b+("<li>"+p.getFullYear()+"/"+(p.getMonth()+1)+"/"+p.getDate()+"</li>");return b+"</ul>"}},CenterModel=
function(b){function c(b,c){var e=b[c].split("/");return new Date(e[0],e[1]-1,e[2])}this.name=b[0];this.startDate=c(b,1);this.endDate=c(b,2)};function get_selected_area_name(){return localStorage.getItem("selected_area_name")}function set_selected_area_name(b){localStorage.setItem("selected_area_name",b)}
$(function(){function b(a){$.getJSON("data/description.json",function(b){for(var c in b)n.push(b[c]);a();$("#accordion2").show()})}function c(a){a=m[a];a.calcMostRect();a.sortTrash();var b=$(window).height()/4,c="",e;for(e in a.trash){var h,d=a.trash[e],l;for(l in n)if(n[l].label==d.label){h=n[l];var g="",f="",g="",k=h.target,s;for(s in k){var q=k[s];f!=q.furigana&&(""!=f&&(g+="</ul>"),f=q.furigana,g+='<h5 class="initials">'+f+"</h5>",g+="<ul>");g+="<li>"+q.name+"</li>"}g+="</ul>";f=d.getDateLabel();
c+='<div class="accordion-group" id="accordion-group'+l+'"><div class="accordion-heading"><a class="accordion-toggle" style="height:'+b+'px" data-toggle="collapse" data-parent="#accordion" href="#collapse'+e+'"><div class="accordion-table" ><img src="'+h.styles.svg+'"  /></div><h6><p class="text-left date">'+f+'</p></h6></a></div><div id="collapse'+e+'" class="accordion-body collapse"><div class="accordion-inner">'+h.description+"<br />"+g+'<div class="targetDays"></div></div></div></div>'}}$("#accordion").html(c);
$(".accordion-body").on("shown.bs.collapse",function(){var a=$("body"),b=$($(this).parent().get(0)).offset().top;a.animate({scrollTop:b},50)});$(".accordion-body").on("hidden.bs.collapse",function(){0==$(".in").length&&$("html, body").scrollTop(0)})}function k(a){-1!=a&&set_selected_area_name(m[a].label);-1!=a&&0==$("#accordion").children().length?b(function(){c(a)}):c(a)}function d(a){switch(a.code){case a.PERMISSION_DENIED:return"User denied the request for Geolocation.";case a.POSITION_UNAVAILABLE:return"Location information is unavailable.";
case a.TIMEOUT:return"The request to get user location timed out.";default:return"An unknown error occurred."}}var e=[],n=[],m=[];$("#select_area").change(function(a){a=$(a.target).val();k(a)});$("#gps_area").click(function(){navigator.geolocation.getCurrentPosition(function(a){$.getJSON("area_candidate.php",{latitude:a.coords.latitude,longitude:a.coords.longitude},function(a){if(!0==a.result){a=a.candidate;var b;a:{for(b in m)if(m[b].label==a)break a;b=-1}$("#select_area").val(b).change();alert(a+
"\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3057\u305f")}else alert(a.reason)})},function(a){alert(d(a))})});null==get_selected_area_name()&&($("#accordion2").show(),$("#collapseZero").addClass("in"));navigator.geolocation||$("#gps_area").css("display","none");(function(){$.get("data/area_days.csv",function(a){a=a.replace("/\u00a5r/gm","");a=a.split(String.fromCharCode(10));var b=a.shift().split(","),c;for(c in a){var d=a[c].split(","),h=new AreaModel;h.label=d[0];h.centerName=d[1];m.push(h);for(c=2;6>
c;c++){var k=new TrashModel(b[c],d[c]);h.trash.push(k)}}$.get("data/center.csv",function(a){a=a.split(String.fromCharCode(10));for(var b in a){var c=a[b].split(","),c=new CenterModel(c);e.push(c)}for(b in m)m[b].setCenter(e);b=get_selected_area_name();a=$("#select_area");var c='<option value="-1">\u672a\u9078\u629e</option>',d;for(d in m)var h=m[d].label,c=c+('<option value="'+d+'" '+(b==h?'selected="selected"':"")+" >"+h+"</option>");a.html(c);a.change()})})})()});
