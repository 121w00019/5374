var AreaModel=function(){this.label;this.centerName;this.center;this.trash=[];this.calcMostRect=function(){for(var b=0;b<this.trash.length;b++)this.trash[b].calcMostRect(this)};this.isBlankDay=function(b){var c=[this.center.startDate,this.center.endDate];return c[0].getTime()<=b.getTime()&&b.getTime()<=c[1].getTime()?!0:!1};this.setCenter=function(b){for(var c in b)this.centerName==b[c].name&&(this.center=b[c])};this.sortTrash=function(){this.trash.sort(function(b,c){var f=b.mostRecent.getTime(),
d=c.mostRecent.getTime();return f<d?-1:f>d?1:0})}},Description=function(){this.label;this.notice},TrashModel=function(b,c){function f(b){for(var a=0;a<m.length;a++)if(m[a]==b)return a;return-1}this.dayLabel;this.mostRecent;this.dayList;this.dayCell=c.split(" ");this.label=b;this.description;var d="",e;for(e in this.dayCell)d=1==this.dayCell[e].length?d+("\u6bce\u9031"+this.dayCell[e]+"\u66dc\u65e5 "):d+("\u7b2c"+this.dayCell[e].charAt(1)+this.dayCell[e].charAt(0)+"\u66dc\u65e5 ");this.dayLabel=d;
this.getDateLabel=function(){var b=this.mostRecent.getFullYear()+"/"+(1+this.mostRecent.getMonth())+"/"+this.mostRecent.getDate();return this.dayLabel+" "+b};var m="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("");this.calcMostRect=function(b){for(var a=this.dayCell,n=[],p=new Date,c=4;15>=c;c++)for(var e in a)for(var d=!1,h=0;5>h;h++){var k=new Date(2013,c-1,1),g=new Date(k);1==a[e].length?(g.setTime(k.getTime()+864E5*((7+f(a[e])-k.getDay())%7)+6048E5*h),g.getMonth()+1==c%12&&(n.push(g),null==
this.mostRecent&&g.getTime()>p.getTime()&&(this.mostRecent=g))):(g.setTime(k.getTime()+864E5*((7+f(a[e].charAt(0))-k.getDay())%7)+6048E5*h),b.isBlankDay(g)&&(d=!0),d&&g.setTime(g.getTime()+6048E5),h==a[e].charAt(1)-1&&(n.push(g),null==this.mostRecent&&g.getTime()>p.getTime()&&(this.mostRecent=g)))}this.dayList=n};this.getDayList=function(){var b="<ul>",a;for(a in this.dayList)var n=this.dayList[a],b=b+("<li>"+n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+"</li>");return b+"</ul>"}},CenterModel=
function(b){function c(b,c){var e=b[c].split("/");return new Date(e[0],e[1]-1,e[2])}this.name=b[0];this.startDate=c(b,1);this.endDate=c(b,2)};function get_selected_area_name(){return localStorage.getItem("selected_area_name")}function set_selected_area_name(b){localStorage.setItem("selected_area_name",b)}
$(function(){function b(a){$.getJSON("description.json",function(b){for(var c in b)m.push(b[c]);a()})}function c(a){a=l[a];a.calcMostRect();a.sortTrash();var b="",c;for(c in a.trash){var e,d=a.trash[c],f;for(f in m)if(m[f].label==d.label){e=m[f];var h="<ul>",k=e.target,g;for(g in k)h+="<li>"+k[g].name+"</li>";h+="</ul>";k=d.getDateLabel();b+='<div class="accordion-group" id="accordion-group'+f+'"><div class="accordion-heading"><a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse'+
c+'"><h2><p class="text-center"><center><img src="'+e.styles.svg+'" /></center></p></h2><h4><p class="text-center">'+e.sublabel+'</p></h4><h6><p class="text-left date">'+k+'</p></h6></a></div><div id="collapse'+c+'" class="accordion-body collapse"><div class="accordion-inner">'+e.description+"<br />"+h+'<div class="targetDays"></div></div></div></div>'}}$("#accordion").html(b);$(".accordion-body").on("shown.bs.collapse",function(){var a=$("body"),b=$($(this).parent().get(0)).offset().top;a.animate({scrollTop:b},
50)})}function f(a){-1!=a&&set_selected_area_name(l[a].label);-1!=a&&0==$("#accordion").children().length?b(function(){c(a)}):c(a)}function d(a){switch(a.code){case a.PERMISSION_DENIED:return"User denied the request for Geolocation.";case a.POSITION_UNAVAILABLE:return"Location information is unavailable.";case a.TIMEOUT:return"The request to get user location timed out.";default:return"An unknown error occurred."}}var e=[],m=[],l=[];$("#select_area").change(function(a){a=$(a.target).val();f(a)});
$("#gps_area").click(function(){navigator.geolocation.getCurrentPosition(function(a){$.getJSON("area_candidate.php",{latitude:a.coords.latitude,longitude:a.coords.longitude},function(a){if(!0==a.result){a=a.candidate;var b;a:{for(b in l)if(l[b].label==a)break a;b=-1}$("#select_area").val(b).change()}else alert(a.reason)})},function(a){alert(d(a))})});null==get_selected_area_name()&&$("#collapseZero").addClass("in");navigator.geolocation||$("#gps_area").css("display","none");(function(){$.get("CSV/area_days.csv",
function(a){a=a.replace("/\u00a5r/gm","");a=a.split(String.fromCharCode(10));var b=a.shift().split(","),c;for(c in a){var d=a[c].split(","),f=new AreaModel;f.label=d[0];f.centerName=d[1];l.push(f);for(c=2;6>c;c++){var m=new TrashModel(b[c],d[c]);f.trash.push(m)}}$.get("CSV/center.csv",function(a){a=a.split(String.fromCharCode(10));for(var b in a){var c=a[b].split(","),c=new CenterModel(c);e.push(c)}for(b in l)l[b].setCenter(e);b=get_selected_area_name();a=$("#select_area");var c='<option value="-1">\u672a\u9078\u629e</option>',
d;for(d in l)var f=l[d].label,c=c+('<option value="'+d+'" '+(b==f?'selected="selected"':"")+" >"+f+"</option>");a.html(c);a.change()})})})()});
